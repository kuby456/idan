<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×¡×™×›×•××™ ×©××œ×•× ×™×</title>
  <style>
:root{
  --bg-color: #f7fafc;
  --card-bg: #ffffff;
  --muted: #6b7280;
  --accent: #2563eb; /* primary blue */
  --accent-2: #f59e0b; /* edit amber */
  --glass: rgba(255,255,255,0.6);
  --card-radius: 12px;
  --shadow: 0 6px 18px rgba(15,23,42,0.08);
  --max-width: 1100px;
  --gap-mobile: 12px;
  --gap-desktop: 18px;
  --ui-font-sm: 0.88rem;
  --ui-font-md: 1rem;
  --ui-font-lg: 1.05rem;
  --touch-target: 48px;
}

/* Reset & base */
*{ box-sizing: border-box; }
html,body{
  height:100%;
  margin:0;
  padding:0;
  direction: rtl; /* ensure RTL layout */
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", "Segoe UI Emoji", "Segoe UI Symbol";
  background:
    linear-gradient(180deg, rgba(37,99,235,0.03), transparent 120px),
    var(--bg-color);
  color: #0f172a;
  -webkit-text-size-adjust:100%;
}

/* Page padding - leave space for mobile fixed actions */
body{
  padding: 18px;
  padding-bottom: 86px; /* room for mobile action bar when shown */
  text-align: right;
}

/* Container for cards - centered, responsive columns */
.cards-container{
  max-width: var(--max-width);
  margin: 12px auto 24px;
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--gap-mobile);
  align-items: start;
  padding: 6px;
}

/* Larger screens: 2-3 columns */
@media (min-width: 640px){
  .cards-container{
    grid-template-columns: repeat(2, 1fr);
    gap: calc(var(--gap-desktop));
  }
}
@media (min-width: 1000px){
  .cards-container{
    grid-template-columns: repeat(3, 1fr);
    gap: 22px;
  }
}

/* Card */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.96), var(--card-bg));
  border-radius: var(--card-radius);
  box-shadow: var(--shadow);
  padding: 14px;
  cursor: pointer;
  transition: transform 180ms cubic-bezier(.2,.9,.2,1), box-shadow 180ms;
  border: 1px solid rgba(15,23,42,0.04);
  min-height: 72px;
  display:flex;
  flex-direction:column;
  gap:8px;
  overflow:hidden;
  position:relative;
  word-break:break-word;
}

/* Hover & focus (desktop) */
@media (hover:hover){
  .card:hover,
  .card:focus{
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(2,6,23,0.12);
    outline: none;
  }
}

/* Open state */
.card.open{
  border-color: rgba(37,99,235,0.12);
  box-shadow: 0 18px 40px rgba(37,99,235,0.08);
}

/* Headings & meta */
.card h3{
  margin:0;
  font-size: var(--ui-font-md);
  font-weight:600;
  color:#071133;
  line-height:1.1;
}
.card p{
  margin:0;
  color: var(--muted);
  font-size: var(--ui-font-sm);
  line-height:1.25;
}

/* Preformatted answers */
.card pre{
  margin: 8px 0 0;
  padding: 12px;
  background: #f8fafc;
  border-radius: 8px;
  color: #0b1220;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Noto Mono", monospace;
  font-size: 0.92rem;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow:auto;
  border: 1px dashed rgba(10,20,40,0.04);
  max-height: 52vh;
}

/* Buttons default */
button{
  -webkit-appearance:none;
  appearance:none;
  border:none;
  cursor:pointer;
  font-weight:600;
  border-radius:10px;
  padding:10px 14px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  justify-content:center;
  transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms;
  box-shadow: 0 6px 14px rgba(2,6,23,0.06);
  color:white;
  text-decoration:none;
  font-size: var(--ui-font-sm);
}

/* Back button (first button in body) */
body > button:first-of-type{
  background: var(--accent);
  color: #fff;
  margin-bottom: 14px;
  padding: 10px 14px;
  border-radius: 8px;
  box-shadow: 0 8px 20px rgba(37,99,235,0.12);
}
@media (max-width:720px){
  body > button:first-of-type{
    padding: 12px 16px;
    font-size: var(--ui-font-md);
  }
}

/* Edit button */
#editQuestionsBtn{
  background: var(--accent-2);
  padding: 10px 16px;
  border-radius: 10px;
  color: #fff;
}
#editQuestionsBtn:hover{ transform: translateY(-2px); }

/* Refresh button */
#refreshBtn{
  background: transparent;
  color: var(--accent);
  border: 1px solid rgba(37,99,235,0.12);
  padding: 9px 12px;
  border-radius: 8px;
  box-shadow: none;
  margin-left: 6px;
}
#refreshBtn:hover{
  background: rgba(37,99,235,0.06);
  transform: translateY(-2px);
}

/* Loading/empty text */
.cards-container > p{
  text-align:center;
  color: var(--muted);
  font-size: var(--ui-font-md);
  padding: 14px;
  margin:8px auto;
}

/* Focus styles for accessibility */
button:focus, .card:focus{
  outline: 3px solid rgba(37,99,235,0.14);
  outline-offset: 2px;
}

/* Ensure wrapping */
.card h3, .card p, .card pre{ overflow-wrap:anywhere; }

/* Mobile-specific adjustments (phone-first) */
@media (max-width:720px){
  body{ padding:14px; padding-bottom: 110px; } /* more space for bottom actions */
  .cards-container{ gap: var(--gap-mobile); padding:4px; }

  .card{
    padding: 14px;
    border-radius: 14px;
    min-height:80px;
  }
  .card h3{ font-size: 1.02rem; }
  .card p{ font-size: var(--ui-font-sm); }

  /* make pre area shorter on mobile so content doesn't push behind action bar */
  .card pre{ max-height: 36vh; font-size: 0.9rem; }

  /* Make buttons larger, easier to tap */
  button{
    min-height: var(--touch-target);
    padding: 12px 16px;
    font-size: var(--ui-font-md);
    border-radius: 12px;
  }

 /* âœ¨ ×××§× ××ª ×›×¤×ª×•×¨×™ ×”×¢×¨×™×›×” ×•×”×¨×¢× ×•×Ÿ ×§×‘×•×¢×™× ×‘×¨××© ×”×“×£ */
#editQuestionsBtn,
#refreshBtn {
  top: 10px;          /* ğŸ“ ××¢×œ×” ××•×ª× ×œ××¢×œ×” */
  z-index: 100;       /* ××¢×œ ×›×œ ×”××œ×× ×˜×™× ×”××—×¨×™× */
  box-shadow: 0 6px 14px rgba(0,0,0,0.1);
}

/* ğŸŸ¦ ×™×™×©×•×¨ × ×›×•×Ÿ ×‘×¨×•×—×‘ ××¡×š × ×™×™×“ */
#editQuestionsBtn {
  right: 16px;        /* ×‘×¦×“ ×™××™×Ÿ */
  left: auto;
  width: calc(50% - 26px);
  max-width: 320px;
  background: #f59e0b;
  color: white;
}

#refreshBtn {
  left: 16px;         /* ×‘×¦×“ ×©×××œ */
  right: auto;
  width: calc(50% - 26px);
  max-width: 320px;
  background: #fff;
  color: var(--accent);
  border: 1px solid rgba(37,99,235,0.12);
  box-shadow: 0 6px 14px rgba(2,6,23,0.06);
}
/* ğŸ”¹ ×¢×™×¦×•×‘ ×”×¡×¨×’×œ ×”×¢×œ×™×•×Ÿ */
.top-buttons {
  display: flex;
  justify-content: center;    /* ××¨×›×– ××ª ×”×›×¤×ª×•×¨×™× */
  align-items: center;
  gap: 12px;                  /* ×¨×•×•×— ×‘×™× ×™×”× */
  margin-bottom: 20px;
  flex-wrap: wrap;            /* ×œ×©×‘×™×¨×” ×™×¤×” ×‘××¡×›×™× ×§×˜× ×™× */
}

/* ğŸ”¹ ×¢×™×¦×•×‘ ××—×™×“ ×œ×©× ×™ ×”×›×¤×ª×•×¨×™× */
.top-buttons button {
  font-family: "Heebo", sans-serif;
  font-weight: bold;
  font-size: 1rem;
  padding: 12px 18px;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  border: none;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

/* âœï¸ ×›×¤×ª×•×¨ ×¢×¨×™×›×” */
#editQuestionsBtn {
  background: #f59e0b;
  color: white;
}
#editQuestionsBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(245,158,11,0.3);
}

/* ğŸ”„ ×›×¤×ª×•×¨ ×¨×¢× ×•×Ÿ */
#refreshBtn {
  background: #2563eb;
  color: white;
}
#refreshBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(37,99,235,0.3);
}


  /* hide the centered edit button's container spacing (if any) by reducing margins */
  #editQuestionsBtn[style], body > div[style] { /* best-effort: don't rely on inline styles but keep safe */
    margin:0;
    text-align:center;
  }

  /* reduce hover transforms on mobile to avoid accidental movement */
  @media (hover:none){
    .card:hover{ transform:none; box-shadow: var(--shadow); }
  }
}

/* Tablet / small-desktop tweaks */
@media (min-width:721px) and (max-width:999px){
  body{ padding:20px; padding-bottom:48px; }
  .cards-container{ gap:16px; }
  .card{ padding:14px; border-radius:12px; }
  button{ font-size: var(--ui-font-md); padding:10px 14px; }
  #editQuestionsBtn, #refreshBtn{ position: static; width: auto; box-shadow: 0 6px 14px rgba(2,6,23,0.06); }
}

/* Larger desktop: subtle spacing increase and hover affordance */
@media (min-width:1000px){
  body{ padding:28px; padding-bottom:48px; }
  .cards-container{ gap: var(--gap-desktop); }
  .card{ padding:16px; border-radius:14px; }
  button{ padding:10px 14px; font-size: var(--ui-font-md); }
  #editQuestionsBtn, #refreshBtn{ position: static; width: auto; }
}

/* Print adjustments */
@media print{
  body{ background:#fff; color:#000; padding:8mm; }
  .cards-container{ grid-template-columns: 1fr !important; gap: 8px; }
  .card{ box-shadow:none; border:1px solid #ddd; }
  button{ display:none; }
}
/* ×”×•×“×¢×” ×‘×××¦×¢ ×”××¡×š */
#centerMessage {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(34,197,94,0.95);
  color: #fff;
  font-size: 1.4rem;
  font-weight: bold;
  padding: 20px 40px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  z-index: 9999;
  display: none;
  text-align: center;
  animation: fadeInOut 2.6s ease forwards;
}

/* ×× ×™××¦×™×” ×§×œ×” */
@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -60%); }
  15% { opacity: 1; transform: translate(-50%, -50%); }
  85% { opacity: 1; transform: translate(-50%, -50%); }
  100% { opacity: 0; transform: translate(-50%, -40%); }
}

.answer-block {
  background: #f9fafb;
  border-radius: 10px;
  padding: 12px 16px;
  margin-bottom: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);

  /* âœ¨ ×¤×ª×™×—×” ××•×˜×•××˜×™×ª ×œ×¤×™ ×›××•×ª ×˜×§×¡×˜ */
  max-height: none;        /* ××™×Ÿ ××’×‘×œ×ª ×’×•×‘×” */
  min-height: auto;        /* ×’×•×‘×” ×‘×”×ª×× ×œ×ª×•×›×Ÿ */
  overflow-y: visible;     /* ×‘×œ×™ ×’×œ×™×œ×” ×¤× ×™××™×ª */
}

.answer-block:nth-child(even) {
  background: #f1f5f9; /* ×’×•×•×Ÿ ××¤×•×¨ ××¢×˜ ×©×•× ×” */
}

/* âœ… ×§×• ×ª×—×ª×•×Ÿ ××§×•×•×§×• ××ª×—×ª ×œ×›×œ ×©××œ×” */
.answer-block .question {
  font-size: 23px;
  font-weight: 900;
  color: #1e3a8a;
  margin-bottom: 6px;
  border-bottom: 3px dashed #9ca3af; /* ×§×• ××§×•×•×§×• ×‘×¦×‘×¢ ××¤×•×¨ ×‘×™× ×•× ×™ */
  padding-bottom: 6px;
}

.answer-block .answer {
  font-size: 20px;
  font-weight: bolder;
  color: #4e4d4d;
  white-space: pre-wrap;
}

/* âœ… ×¢×™×¦×•×‘ ×¤×¡ ×’×œ×™×œ×” ×œ×“×¤×“×¤× ×™ WebKit (×›×¨×•× / Edge / ×¡×¤××¨×™) */
.answer-block::-webkit-scrollbar {
  width: 6px;
}
.answer-block::-webkit-scrollbar-thumb {
  background-color: #cbd5e1;
  border-radius: 10px;
}
.answer-block::-webkit-scrollbar-track {
  background: #f9fafb;
}

/* âœ… ××›×•×œ×ª ×›×œ ×”×©××œ×•×ª ×‘×ª×•×š ×›×œ ×¡×™×›×•× (×›×œ ×”×©××œ×•×Ÿ ×›×•×œ×•) */
.card.open {
  max-height: 550px;        /* ×’×•×‘×” ×§×‘×•×¢ ×œ×©××œ×•×Ÿ ×©×œ× */
  overflow-y: auto;         /* ×’×œ×™×œ×” ×× ×›×™×ª */
  padding: 14px 12px 16px;  /* ×¨×™×•×•×— ×¤× ×™××™ × ×¢×™× */
  display: flex;
  flex-direction: column;
  gap: 14px;                /* âœ… ×¨×•×•×— ×‘×™×Ÿ ×”×‘×œ×•×§×™× ×©×œ ×”×©××œ×•×ª */
  scrollbar-width: thin;
  scrollbar-color: #cbd5e1 #f9fafb;
}

/* ×¢×™×¦×•×‘ ×¤×¡ ×’×œ×™×œ×” (×›×¨×•×/Edge) */
.card.open::-webkit-scrollbar {
  width: 8px;
}
.card.open::-webkit-scrollbar-thumb {
  background-color: #cbd5e1;
  border-radius: 10px;
}
.card.open::-webkit-scrollbar-track {
  background: #f9fafb;
}
.card.selected-for-delete {
  background: #fee2e2; /* ××“×•× ×‘×”×™×¨ */
  border-color: #f87171;
  transition: background 0.2s ease, border 0.2s ease;
}

/* ğŸ¯ ×§×•×•×¨×˜/×—××™×©×™×™×” ×©×œ ×›×¤×ª×•×¨×™× ×¢× ××¡×’×¨×ª ×›×—×•×œ×” ××—×™×“×” */
.button-quartet {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  border: 3px solid #2563eb;   /* ğŸ”¹ ×¦×‘×¢ ×”××¡×’×¨×ª */
  border-radius: 16px;
  padding: 16px;
  background: #ffffff;
  max-width: 550px;
  margin: 20px auto;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* ğŸ¨ ×¢×™×¦×•×‘ ×›×œ ×›×¤×ª×•×¨ */
.button-quartet button {
  flex: 1 1 160px;
  padding: 12px 18px;
  font-size: 1rem;
  font-weight: bold;
  border: 2px solid #2563eb;   /* ğŸ”¹ ××¡×’×¨×ª ×–×”×” */
  border-radius: 10px;
  background: transparent;
  color: #2563eb;
  cursor: pointer;
  transition: 0.25s;
}

/* âœ¨ ××¤×§×˜ ×¨×™×—×•×£ */
.button-quartet button:hover {
  background: #2563eb;
  color: #fff;
  transform: translateY(-3px);
}

/* ğŸ” ×”×ª×××” ×¡×¤×¦×™×¤×™×ª ×œ×›×¤×ª×•×¨ ×¨×¢× ×•×Ÿ (××•×ª×• ×¡×’× ×•×Ÿ ×›××• ×”×©××¨) */
#refreshBtn {
  border: 2px solid #2563eb !important;
  background: transparent !important;
  color: #2563eb !important;
  box-shadow: none !important;
}
#refreshBtn:hover {
  background: #2563eb !important;
  color: #fff !important;
}

/* ğŸ§­ ××›×•×œ×” ××¨×›×–×ª ××ª ×›×¤×ª×•×¨×™ ×”×”×“×¤×¡×”, ×”×‘×—×™×¨×” ×•×”×›×•×ª×¨×ª */
.center-buttons {
  display: flex;
  flex-direction: column;      /* ×¢×¨×™××” ×× ×›×™×ª */
  align-items: center;         /* ×××¨×›×–×ª ×‘×××¦×¢ */
  justify-content: center;
  gap: 12px;
  margin-top: 25px;
  text-align: center;
}

/* ğŸ¨ ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ ×œ×›×¤×ª×•×¨×™× */
.center-buttons button {
  background: #2563eb;
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}

.center-buttons button:hover {
  background: #1e3a8a;
  transform: translateY(-2px);
}

/* ğŸ·ï¸ ×”×›×•×ª×¨×ª */
.center-buttons h1 {
  margin: 10px 0 0;
  color: #1e3a8a;
  font-size: 1.6rem;
  text-align: center;
}


  </style>
</head>
<body>
<div class="button-quartet">
  <button id="backBtn" onclick="window.location.href='index.html'">â†©ï¸ ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</button>
  <button id="editQuestionsBtn">âœï¸ ××•×¡×£/××—×§ ×©××œ×•×ª</button>
  <button id="deleteModeBtn">ğŸ—‘ï¸ ××—×§ ×©××œ×•× ×™×</button>
  <button id="printModeBtn">ğŸ–¨ï¸ ××¦×‘ ×”×“×¤×¡×”</button>
  <button id="refreshBtn">ğŸ”„ ×¨×¢× ×Ÿ × ×ª×•× ×™×</button>
</div>

<div class="center-buttons">
  <button id="printSelectedBtn" style="display:none;">ğŸ–¨ï¸ ×”×“×¤×¡ × ×‘×—×¨×™×</button>
  <button id="selectAllBtn" style="display:none;">âœ”ï¸ ×‘×—×¨ ×”×›×•×œ</button>
  <h1>×¡×™×›×•××™ ×©××œ×•× ×™ ××™× ×˜×™×™×§</h1>
</div>








  <div class="cards-container" id="cardsContainer"></div>
<div id="centerMessage">âœ… × ×©×œ×— ×‘×”×¦×œ×—×”!</div>

 <script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabaseUrl = "https://tgfqsmarvznpzwdixvye.supabase.co";
const supabaseKey =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnZnFzbWFydnpucHp3ZGl4dnllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3OTM1NzEsImV4cCI6MjA3NjM2OTU3MX0.ui5rHWh8KgSmhYrl_unozb9rwAaZQeTNEeMZF63lhYM";
const supabase = createClient(supabaseUrl, supabaseKey);

const container = document.getElementById("cardsContainer");
const refreshBtn = document.getElementById("refreshBtn");
const editBtn = document.getElementById("editQuestionsBtn");
const deleteModeBtn = document.getElementById("deleteModeBtn");
const selectAllBtn = document.getElementById("selectAllBtn");

let deleteMode = false; // ××¦×‘ ××—×™×§×” ××•×¤×¢×œ ××• ×œ×

// ğŸ’š ××¦×‘ ×”×“×¤×¡×” × ×¤×¨×“ (×œ× ×§×©×•×¨ ×œ××—×™×§×”)
let printMode = false;
const printModeBtn = document.getElementById("printModeBtn");
const printSelectedBtn = document.getElementById("printSelectedBtn");

// ××¦×‘ ×”×“×¤×¡×” - ×”×“×œ×§×”/×›×™×‘×•×™
printModeBtn.onclick = () => {
  printMode = !printMode;

  if (printMode) {
    printModeBtn.textContent = "âŒ ×¡×’×•×¨ ××¦×‘ ×”×“×¤×¡×”";
    printSelectedBtn.style.display = "inline-block";
    showCenterMessage("ğŸŸ© ××¦×‘ ×”×“×¤×¡×” ×”×•×¤×¢×œ");
    loadCards(); // ×œ×˜×¢×•×Ÿ ××—×“×© ×¢× ×ª×™×‘×•×ª ×™×¨×•×§×•×ª
  } else {
    printModeBtn.textContent = "ğŸ–¨ï¸ ××¦×‘ ×”×“×¤×¡×”";
    printSelectedBtn.style.display = "none";
    showCenterMessage("××¦×‘ ×”×“×¤×¡×” × ×¡×’×¨");
    loadCards();
  }
};

// ğŸ§­ ×˜×¢×™× ×ª ×”×¡×™×›×•××™×
async function loadCards() {
  container.innerHTML = "<p>â³ ×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>";

  const { data, error } = await supabase
    .from("intake_forms")
    .select("*")
    .order("id", { ascending: false });

  if (error) {
    container.innerHTML = "<p>âŒ ×©×’×™××” ×‘×˜×¢×™× ×”.</p>";
    return;
  }

  container.innerHTML = "";
  if (!data || data.length === 0) {
    container.innerHTML = "<p>××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”.</p>";
    return;
  }

  data.forEach((row) => {
    const card = document.createElement("div");
    card.className = "card";

    // âœ³ï¸ ××‘× ×” ×”×›×¨×˜×™×¡
    card.innerHTML = `
${(deleteMode || printMode) ?
  `<input type="checkbox" class="${deleteMode ? 'delete-checkbox' : 'print-checkbox'}"
   data-id="${row.id}"
   style="margin-left:10px; transform:scale(1.3); cursor:pointer; accent-color:${printMode ? '#22c55e' : '#ef4444'};">`
  : ""}
      <h3 style="display:inline-block; margin-right:6px;">${row.full_name}</h3>
<p>
  ${new Date(row.created_at).toLocaleDateString("he-IL")}
  <span style="color:#64748b; font-size:0.9em;">
    ${new Date(row.created_at).toLocaleTimeString("he-IL", { hour: '2-digit', minute: '2-digit' })}
  </span>
</p>
    `;

    // âœ³ï¸ ×¤×ª×™×—×” ×•×¡×’×™×¨×”
    card.addEventListener("click", (e) => {
      // ×× × ×œ×—×¥ ×¢×œ ×”×¦'×§×‘×•×§×¡ â€” ××œ ×ª×¤×ª×—/×¡×’×•×¨
if (e.target.classList.contains("delete-checkbox") || e.target.classList.contains("print-checkbox")) return;

      if (card.classList.contains("open")) {
        card.classList.remove("open");
        card.innerHTML = `
${(deleteMode || printMode) ?
  `<input type="checkbox" class="${deleteMode ? 'delete-checkbox' : 'print-checkbox'}"
   data-id="${row.id}"
   style="margin-left:10px; transform:scale(1.3); cursor:pointer; accent-color:${printMode ? '#22c55e' : '#ef4444'};">`
  : ""}
          <h3 style="display:inline-block; margin-right:6px;">${row.full_name}</h3>
<p>
  ${new Date(row.created_at).toLocaleDateString("he-IL")}
  <span style="color:#64748b; font-size:0.9em;">
    ${new Date(row.created_at).toLocaleTimeString("he-IL", { hour: '2-digit', minute: '2-digit' })}
  </span>
</p>
        `;
      } else {
        card.classList.add("open");

        const answersHTML = Object.entries(row.answers)
          .map(
            ([q, a]) => `
              <div class="answer-block">
                <div class="question">${q}</div>
                <div class="answer">${a}</div>
              </div>
            `
          )
          .join("");

        card.innerHTML = `
${(deleteMode || printMode) ?
  `<input type="checkbox" class="${deleteMode ? 'delete-checkbox' : 'print-checkbox'}"
   data-id="${row.id}"
   style="margin-left:10px; transform:scale(1.3); cursor:pointer; accent-color:${printMode ? '#22c55e' : '#ef4444'};">`
  : ""}
          <h3 style="display:inline-block; margin-right:6px;">${row.full_name}</h3>
          <p>${new Date(row.created_at).toLocaleDateString("he-IL")}</p>
          ${answersHTML}
        `;
      }
    });

    container.appendChild(card);
  });
}

// ğŸŒ€ ×¨×¢× ×•×Ÿ
refreshBtn.onclick = () => loadCards();

// âœï¸ ××¢×‘×¨ ×œ×¢××•×“ ×¢×¨×™×›×”
editBtn.onclick = () => {
  window.location.href = "edit_questions.html";
};

// ğŸš€ ×˜×¢×™× ×” ×¨××©×•× ×™×ª
loadCards();

// ğŸ—‘ï¸ ×›×¤×ª×•×¨ ×™×—×™×“ â€” ××—×™×§×”/×›× ×™×¡×” ×œ××¦×‘ ××—×™×§×”
deleteModeBtn.onclick = async () => {
  const showMessage = (text, color = "#22c55e") => {
    const msg = document.getElementById("centerMessage");
    msg.textContent = text;
    msg.style.background = color;
    msg.style.display = "block";
    setTimeout(() => (msg.style.display = "none"), 2500);
  };

  // ×× ×›×‘×¨ ×‘××¦×‘ ××—×™×§×”
  if (deleteMode) {
    const checked = Array.from(document.querySelectorAll(".delete-checkbox:checked"));

    if (checked.length === 0) {
      // ××™×Ÿ × ×‘×—×¨×™× â†’ ×™×¦×™××”
      deleteMode = false;
      selectAllBtn.style.display = "none";
      deleteModeBtn.textContent = "ğŸ—‘ï¸ ××—×§ ×©××œ×•× ×™×";
      loadCards();
      showMessage("â— ×œ× × ×‘×—×¨×• ×©××œ×•× ×™× ×œ××—×™×§×”", "#f59e0b");
      return;
    }

    // ğŸ§¾ ×™×¦×™×¨×ª ×ª×™×‘×ª ××™×©×•×¨ ×•×™×–×•××œ×™×ª ×‘××§×•× confirm()
    const confirmBox = document.createElement("div");
    confirmBox.style.position = "fixed";
    confirmBox.style.top = "50%";
    confirmBox.style.left = "50%";
    confirmBox.style.transform = "translate(-50%, -50%)";
    confirmBox.style.background = "#fff";
    confirmBox.style.padding = "24px 32px";
    confirmBox.style.borderRadius = "12px";
    confirmBox.style.boxShadow = "0 12px 40px rgba(0,0,0,0.25)";
    confirmBox.style.textAlign = "center";
    confirmBox.style.zIndex = "9999";
    confirmBox.style.fontSize = "1.1rem";
    confirmBox.innerHTML = `
      <p style="margin-bottom:18px; color:#1e3a8a; font-weight:bold;">
        ${checked.length === document.querySelectorAll(".delete-checkbox").length
          ? "×œ××—×•×§ ××ª ×›×œ ×”×©××œ×•× ×™× ×œ×¦××™×ª×•×ª?"
          : `×œ××—×•×§ ${checked.length} ×©××œ×•× ×™× ×©× ×‘×—×¨×•?`}
      </p>
      <div style="display:flex; justify-content:center; gap:14px;">
        <button id="confirmYes" style="background:#ef4444; color:#fff; padding:10px 18px; border:none; border-radius:8px; font-weight:bold;">××—×§</button>
        <button id="confirmNo" style="background:#9ca3af; color:#fff; padding:10px 18px; border:none; border-radius:8px;">×‘×˜×œ</button>
      </div>
    `;
    document.body.appendChild(confirmBox);

    // ğŸ§© ×××–×™× ×™× ×œ×›×¤×ª×•×¨×™×
    document.getElementById("confirmNo").onclick = () => {
      confirmBox.remove();
      showMessage("×‘×•×˜×œ×” ×”××—×™×§×”", "#9ca3af");
    };

    document.getElementById("confirmYes").onclick = async () => {
      confirmBox.remove();

      // ××—×™×§×ª ×”× ×‘×—×¨×™×
      const deletions = checked.map(cb => supabase.from("intake_forms").delete().eq("id", cb.dataset.id));
      const results = await Promise.all(deletions);
      const failed = results.some(r => r.error);

      if (failed) showMessage("âš ï¸ ×©×’×™××” ×‘××—×™×§×”!", "#dc2626");
      else showMessage("âœ… ×”×¡×™×›×•××™× × ××—×§×• ×‘×”×¦×œ×—×”!");

      deleteMode = false;
      selectAllBtn.style.display = "none";
      deleteModeBtn.textContent = "ğŸ—‘ï¸ ××—×§ ×©××œ×•× ×™×";
      await loadCards();
    };

    return;
  }

  // ×× ×¢×•×“ ×œ× ×‘××¦×‘ ××—×™×§×” â€” ×”×¤×¢×œ×”
  deleteMode = true;
  selectAllBtn.style.display = "inline-block";
  deleteModeBtn.textContent = "âŒ ××—×§ × ×‘×—×¨×™× / ×™×¦×™××”";
  showMessage("ğŸ“‹ ××¦×‘ ××—×™×§×” ×”×•×¤×¢×œ", "#3b82f6");
  loadCards();
};



// âœ”ï¸ ×›×¤×ª×•×¨ "×‘×—×¨ ×”×›×•×œ" â€” ×¢×›×©×™×• ×¢×•×‘×“ ×›××• ×˜×•×’×œ
let allSelected = false;

selectAllBtn.onclick = () => {
  const checkboxes = document.querySelectorAll(".delete-checkbox");
  allSelected = !allSelected;

  checkboxes.forEach(cb => cb.checked = allSelected);

  // ××©× ×” ××ª ×”×˜×§×¡×˜ ×©×œ ×”×›×¤×ª×•×¨ ×‘×”×ª×× ×œ××¦×‘
  selectAllBtn.textContent = allSelected ? "ğŸš« ×‘×˜×œ ×‘×—×™×¨×”" : "âœ”ï¸ ×‘×—×¨ ×”×›×•×œ";
};


// ğŸ¨ ×”×•×¡×¤×ª ×¨×§×¢ ××“××“× ×œ×¤×¨×™×˜×™× ×©× ×‘×—×¨×•
document.addEventListener("change", (e) => {
  if (e.target.classList.contains("delete-checkbox")) {
    e.target.closest(".card").classList.toggle("selected-for-delete", e.target.checked);
  }
});

// âœ… ×”×•×“×¢×ª ××¨×›×– (×× ×ª×¨×¦×” ×œ×”×©×ª××©)
function showCenterMessage(text = "âœ… × ×©×œ×— ×‘×”×¦×œ×—×”!") {
  const msg = document.getElementById("centerMessage");
  msg.textContent = text;
  msg.style.display = "block";
  setTimeout(() => {
    msg.style.display = "none";
  }, 2500);
}
// ğŸ–¨ï¸ ×”×“×¤×¡ ×¨×§ ×¡×™×›×•××™× ××¡×•×× ×™× ×‘××¦×‘ ×”×“×¤×¡×”
printSelectedBtn.onclick = () => {
  const selectedCards = Array.from(document.querySelectorAll(".print-checkbox:checked"))
    .map(cb => cb.closest(".card"));

  if (selectedCards.length === 0) {
    showCenterMessage("â— ×œ× × ×‘×—×¨×• ×¡×™×›×•××™× ×œ×”×“×¤×¡×”");
    return;
  }

  const printWindow = window.open("", "_blank");
  const printContent = `
    <html lang="he" dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>×”×“×¤×¡×” ×©×œ ×¡×™×›×•××™× × ×‘×—×¨×™×</title>
      <style>
        body { font-family: "Heebo", sans-serif; direction: rtl; padding: 20px; }
        .card { border:1px solid #ccc; border-radius:10px; padding:14px; margin-bottom:20px; }
        .question { font-weight:bold; color:#1e3a8a; margin-bottom:6px; border-bottom:1px dashed #9ca3af; padding-bottom:4px; }
        .answer { color:#333; margin-bottom:8px; white-space:pre-wrap; }
        hr { border:none; border-top:2px dashed #ccc; margin:20px 0; }
      </style>
    </head>
    <body>
      <h2 style="text-align:center;">ğŸ–¨ï¸ ×¡×™×›×•××™× × ×‘×—×¨×™×</h2>
      ${selectedCards.map(c => c.outerHTML + "<hr>").join("")}
      <script>window.onload = () => window.print();<\/script>
    </body>
    </html>
  `;
  printWindow.document.write(printContent);
  printWindow.document.close();
};

</script>


</body>
</html>
